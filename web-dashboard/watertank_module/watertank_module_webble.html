<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VBM Domobar Standaard Control System - Waterniveau</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%232563eb'/%3E%3Cstop offset='1' stop-color='%2316a34a'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect x='4' y='4' width='56' height='56' rx='12' fill='url(%23g)'/%3E%3Cpath d='M32 12 C 20 28 20 28 32 48 C 44 28 44 28 32 12 Z' fill='%23fff'/%3E%3C/svg%3E" />
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%232563eb'/%3E%3Cstop offset='1' stop-color='%2316a34a'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect x='4' y='4' width='56' height='56' rx='12' fill='url(%23g)'/%3E%3Cpath d='M32 12 C 20 28 20 28 32 48 C 44 28 44 28 32 12 Z' fill='%23fff'/%3E%3C/svg%3E" />
  <!--
    Pure CSS + vanilla JS variant (geen externe frameworks of libraries)
    - Web Bluetooth Nordic UART UUID's
      * Service: 6e400001-b5a3-f393-e0a9-e50e24dcca9e
      * RX (write): 6e400002-b5a3-f393-e0a9-e50e24dcca9e
      * TX (notify):6e400003-b5a3-f393-e0a9-e50e24dcca9e
  -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>VBM Domobar Standaard Control System - Waterniveau</h1>

  <div class="card">
    <div class="row">
      <button id="btnConnect" class="btn-blue">Verbinden</button>
      <button id="btnDisconnect" disabled>Verbreken</button>
      <label><input type="checkbox" id="autoReconnect" checked> Auto-reconnect</label>
      <span id="connBadge" class="badge b-gray">idle</span>
      <span style="flex:1"></span>
      <label class="muted" title="Toon onderhouds- en expertfuncties."><input type="checkbox" id="modeExpert"> Onderhoudsmodus</label>
    </div>
  </div>

  <div class="card">
    <div class="row space">
      <strong>Status</strong>
      <span id="stateBadge" class="badge b-gray">—</span>
    </div>
    <div class="row space expert">
      <span>Gereed</span>
      <span id="readyBadge" class="badge b-gray">—</span>
    </div>
    <div class="row space">
      <span>Waterniveau</span>
      <span id="pct">—</span>
    </div>
    <div class="bar" id="lvlBar"><div id="lvlFill"></div></div>
    <div class="row user" id="userHintRow" style="margin-top:6px; width:100%;">
      <div id="userHintBox" class="user-hint">
        <span id="userHintDot" class="uh-dot"></span>
        <span id="userHint" class="muted">—</span>
      </div>
    </div>
    <div class="row user hidden" id="testIndicatorRow" style="margin-top:6px; width:100%;">
      <div class="test-ind">
        <span class="ti-dot"></span>
        <strong>Testcyclus actief</strong>
        <span class="muted">Sommige waarden kunnen tijdelijk afwijken.</span>
      </div>
    </div>
    <div class="row space expert" style="margin-top:6px;">
      <span>EMA (mm)</span>
      <span id="ema">—</span>
    </div>
    <div class="row space expert">
      <span>Obs. min/max (mm)</span>
      <span id="obs">—</span>
    </div>
  </div>

  <div class="card">
    <div class="row expert" style="gap:8px;">
      <button class="cmd" data-cmd="INFO?" disabled>INFO?</button>
      <button class="cmd" data-cmd="CFG?" disabled>CFG?</button>
      <button class="cmd btn-blue" data-cmd="CAL FULL" disabled>CAL FULL</button>
      <button class="cmd btn-blue" data-cmd="CAL EMPTY" disabled>CAL EMPTY</button>
      <button class="cmd btn-amber" data-cmd="CAL CLEAR" disabled>CAL CLEAR</button>
      <button id="btnAutoCal" class="btn-blue" disabled>Auto-Calibratie</button>
      <span class="muted">| Test</span>
      <button class="cmd" data-cmd="TEST START" disabled>TEST START</button>
      <button class="cmd" data-cmd="TEST START PIPE" disabled>TEST START PIPE</button>
      <button class="cmd btn-amber" data-cmd="TEST START PIPE OUT" disabled title="Pipeline test met outputs vrijgegeven (alleen veilig in testomgeving)">TEST PIPE OUT</button>
      <button class="cmd" data-cmd="TEST FAST" disabled title="Versnelde testzaagtand (8s periode)">TEST FAST</button>
      <button class="cmd" data-cmd="TEST STOP" disabled>TEST STOP</button>
      <button class="cmd" data-cmd="TEST?" disabled>TEST?</button>
    </div>

    <!-- Inline stappenpaneel -->
    <div id="stepsPanel" class="steps hidden expert" style="margin-top:8px;">
      <div class="row space">
        <strong>Auto-calibratie</strong>
        <span id="stepBadge" class="badge b-gray">Stap 1/2</span>
      </div>
      <div id="stepMsg" class="muted" style="margin:6px 0 8px 0;">Vul de tank volledig en wacht tot het niveau stabiel is. Klik op “Markeer FULL”.</div>
      <div class="row" style="gap:8px;">
        <button id="stepBack" disabled>Terug</button>
        <button id="stepCancel" class="btn-amber">Annuleren</button>
        <button id="stepNext" class="btn-blue">Markeer FULL</button>
      </div>
    </div>
  </div>

  <div class="card expert" id="cfgCard">
    <strong>Laatst ontvangen INFO</strong>
    <pre id="infoDump">—</pre>
    <div style="height:8px"></div>
    <strong>Laatst ontvangen CFG</strong>
    <pre id="cfgDump">—</pre>
  </div>

  <div class="card expert">
    <strong>Event Log</strong>
    <div id="log" class="log"></div>
  </div>

  <div class="card expert">
    <div class="row" style="gap:8px;">
      <strong>Service</strong>
      <span class="muted">—</span>
    </div>
    <div class="row" style="gap:8px; margin-top:6px;">
      <button id="btnCfgReset" class="btn-amber">Reset config</button>
      <button id="btnExportLog">Export log</button>
    </div>
  </div>

  <script src="app.js?v=4"></script>
</body>
</html>
